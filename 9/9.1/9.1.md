# 9.1. Índices






# Módulo 5
Consulta a realizar:


```sql
SELECT ci.Nombre_categoriainsumo, 
       s.Nombre_subcategoria, 
       i.Nombre_Insumo, 
       um.Nombre_unidad, 
       s2.Cantidad, 
       ta.Nombre_tipo_almacen, 
       a.Cod_almacen, 
       l.Nombre_local, 
       s2.Fecha_vencimiento, 
       p.Nombre_empresa, 
       s2.Cod_stock
FROM Insumo i 
INNER JOIN Subcategoria s ON s.Cod_subcategoria = i.Cod_subcategoria  -- Subcategoria debe ser primero
INNER JOIN Categoria_insumo ci ON ci.Cod_categoriainsumo = s.Cod_categoria  -- Relacionar Subcategoria con Categoria
INNER JOIN Unidad_medidad um ON um.Cod_unidad = i.Cod_unidad 
INNER JOIN Stock s2 ON i.Cod_insumo = s2.Cod_insumo
INNER JOIN Almacen a ON a.Cod_almacen = s2.Cod_almacen
INNER JOIN "local" l ON l.Cod_local = a.Cod_local
INNER JOIN Tipo_almacen ta ON ta.Cod_tipo_almacen = a.Cod_almacen
INNER JOIN Proveedor p ON p.Cod_proveedor = s2.Cod_proveedor
WHERE l.Cod_local = 1
AND i.Nombre_Insumo ilike COALESCE('onion' || '%')
```

Ejecución sin Indice:
```sql
explain analyze
SELECT ci.Nombre_categoriainsumo, 
       s.Nombre_subcategoria, 
       i.Nombre_Insumo, 
       um.Nombre_unidad, 
       s2.Cantidad, 
       ta.Nombre_tipo_almacen, 
       a.Cod_almacen, 
       l.Nombre_local, 
       s2.Fecha_vencimiento, 
       p.Nombre_empresa, 
       s2.Cod_stock
FROM Insumo i 
INNER JOIN Subcategoria s ON s.Cod_subcategoria = i.Cod_subcategoria  -- Subcategoria debe ser primero
INNER JOIN Categoria_insumo ci ON ci.Cod_categoriainsumo = s.Cod_categoria  -- Relacionar Subcategoria con Categoria
INNER JOIN Unidad_medidad um ON um.Cod_unidad = i.Cod_unidad 
INNER JOIN Stock s2 ON i.Cod_insumo = s2.Cod_insumo
INNER JOIN Almacen a ON a.Cod_almacen = s2.Cod_almacen
INNER JOIN "local" l ON l.Cod_local = a.Cod_local
INNER JOIN Tipo_almacen ta ON ta.Cod_tipo_almacen = a.Cod_almacen
INNER JOIN Proveedor p ON p.Cod_proveedor = s2.Cod_proveedor
WHERE l.Cod_local = 1
AND i.Nombre_Insumo ilike COALESCE('onion' || '%')
```

Resultado:

![alt text](/Capturas/Modulo5/SinIndice1.png)
![alt text](/Capturas/Modulo5/SinIndice2.png)
![alt text](/Capturas/Modulo5/SinIndice3.png)

Creación del índice:

```sql
create index IDX_nombre_insumo on insumo(nombre_insumo)
```

Ejecución con índice:

```sql
explain analyze
SELECT ci.Nombre_categoriainsumo, 
       s.Nombre_subcategoria, 
       i.Nombre_Insumo, 
       um.Nombre_unidad, 
       s2.Cantidad, 
       ta.Nombre_tipo_almacen, 
       a.Cod_almacen, 
       l.Nombre_local, 
       s2.Fecha_vencimiento, 
       p.Nombre_empresa, 
       s2.Cod_stock
FROM Insumo i 
INNER JOIN Subcategoria s ON s.Cod_subcategoria = i.Cod_subcategoria  -- Subcategoria debe ser primero
INNER JOIN Categoria_insumo ci ON ci.Cod_categoriainsumo = s.Cod_categoria  -- Relacionar Subcategoria con Categoria
INNER JOIN Unidad_medidad um ON um.Cod_unidad = i.Cod_unidad 
INNER JOIN Stock s2 ON i.Cod_insumo = s2.Cod_insumo
INNER JOIN Almacen a ON a.Cod_almacen = s2.Cod_almacen
INNER JOIN "local" l ON l.Cod_local = a.Cod_local
INNER JOIN Tipo_almacen ta ON ta.Cod_tipo_almacen = a.Cod_almacen
INNER JOIN Proveedor p ON p.Cod_proveedor = s2.Cod_proveedor
WHERE l.Cod_local = 1
AND i.Nombre_Insumo ilike COALESCE('onion' || '%')
```

Resultado:

![alt text](/Capturas/Modulo5/ConIndice1.png)
![alt text](/Capturas/Modulo5/ConIndice2.png)
![alt text](/Capturas/Modulo5/ConIndice3.png)

Sample content for section 9.1.